{% extends "ajax_imaging/base.html" %}
{% block title %}My Image Archive{% endblock %}

{% block jsblock %}
                <link type="text/css" href="{{MEDIA_URL}}css/smoothness/ui.all.css" rel="stylesheet" />
                <script type="text/javascript" src="{{MEDIA_URL}}js/jquery-1.3.2.js"></script>
                <script type="text/javascript" src="{{MEDIA_URL}}js/ui.core.js"></script>
                <script type="text/javascript" src="{{MEDIA_URL}}js/ui.draggable.js"></script>
                <script type="text/javascript" src="{{MEDIA_URL}}js/ui.droppable.js"></script>
		<link type="text/css" href="{{MEDIA_URL}}css/demos.css" rel="stylesheet" />
                <style type="text/css">
                        #gallery { float: left; width: 65%; min-height: 12em; } * html #gallery { height: 12em; } /* IE6 */
                        .gallery.custom-state-active { background: #eee; }
                        .gallery li { float: left; width: 96px; padding: 0.4em; margin: 0 0.4em 0.4em 0; text-align: center; }
                        .gallery li h5 { margin: 0 0 0.4em; cursor: move; }
                        .gallery li a { float: right; }
                        .gallery li a.ui-icon-zoomin { float: left; }
                        .gallery li img { width: 100%; cursor: move; }

                        #trash { float: right; width: 32%; min-height: 18em; padding: 1%;} * html #trash { height: 18em; } /* IE6 */
                        #trash h4 { line-height: 16px; margin: 0 0 0.4em; }
                        #trash h4 .ui-icon { float: left; }
                        #trash .gallery h5 { display: none; }
                </style>
                <script type="text/javascript">
                        $(function() {
                                // there's the gallery and the trash
                                var $gallery = $('#gallery'), $trash = $('#trash');

                                // let the gallery items be draggable
                                $('li',$gallery).draggable({
                                        cancel: 'a.ui-icon',// clicking an icon won't initiate dragging
                                        revert: 'invalid', // when not dropped, the item will revert back to its initial position
                                        containment: $('#demo-frame').length ? '#demo-frame' : 'document', // stick to demo-frame if present
                                        helper: 'clone',
                                        cursor: 'move'
                                });

                                // let the trash be droppable, accepting the gallery items
                                $trash.droppable({
                                        accept: '#gallery > li',
                                        activeClass: 'ui-state-highlight',
                                        drop: function(ev, ui) {
                                                deleteImage(ui.draggable);
                                        }
                                });

                                // let the gallery be droppable as well, accepting items from the trash
                                $gallery.droppable({
                                        accept: '#trash li',
                                        activeClass: 'custom-state-active',
                                        drop: function(ev, ui) {
                                                recycleImage(ui.draggable);
                                        }
                                });

                                // image deletion function
                                var recycle_icon = '<a href="link/to/recycle/script/when/we/have/js/off" title="Recycle this image" class="ui-icon ui-icon-refresh">Recycle image</a>';
                                function deleteImage($item) {
                                        $item.fadeOut(function() {
                                                var $list = $('ul',$trash).length ? $('ul',$trash) : $('<ul class="gallery ui-helper-reset"/>').appendTo($trash);

                                                $item.find('a.ui-icon-trash').remove();
                                                $item.append(recycle_icon).appendTo($list).fadeIn(function() {
                                                        $item.animate({ width: '48px' }).find('img').animate({ height: '36px' });
                                                });
                                        });
                                }

                                // image recycle function
                                var trash_icon = '<a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete image</a>';
                                function recycleImage($item) {
                                        $item.fadeOut(function() {
                                                $item.find('a.ui-icon-refresh').remove();
                                                $item.css('width','96px').append(trash_icon).find('img').css('height','72px').end().appendTo($gallery).fadeIn();
                                        });
                                }

                                // image preview function, demonstrating the ui.dialog used as a modal window
                                function viewLargerImage($link) {
                                        var src = $link.attr('href');
                                        var title = $link.siblings('img').attr('alt');
                                        var $modal = $('img[src$="'+src+'"]');

                                        if ($modal.length) {
                                                $modal.dialog('open')
                                        } else {
                                                var img = $('<img alt="'+title+'" width="384" height="288" style="display:none;padding: 8px;" />')
                                                        .attr('src',src).appendTo('body');
                                                setTimeout(function() {
                                                        img.dialog({
                                                                title: title,
								width: 400,
								modal: true
							});
						}, 1);
					}
				}
				// resolve the icons behavior with event delegation
                                $('ul.gallery > li').click(function(ev) {
                                        var $item = $(this);
                                        var $target = $(ev.target);

                                        if ($target.is('a.ui-icon-trash')) {
                                                deleteImage($item);
                                        } else if ($target.is('a.ui-icon-zoomin')) {
//                                                viewLargerImage($target);
						return true;
                                        } else if ($target.is('a.ui-icon-edit')) {
					    return true;
                                        } else if ($target.is('a.ui-icon-refresh')) {
                                                recycleImage($item);
                                        }

                                        return false;
                                });
                        });
                </script>
{% endblock %}

{% block content %}
{% if list %}
                <div class="demo ui-widget ui-helper-clearfix">
                        <ul id="gallery" class="gallery ui-helper-reset ui-helper-clearfix">
{% for img in list %}
				<li id="id-{{img.id}}" class="ui-widget-content ui-corner-tr">
				<input type="hidden" id="i-{{img.id}}" value="{{img.id}}" name="delimg[]" >                                
                                        <h5 class="ui-widget-header">{{img}}</h5>
                                        <img style="margin:0px;padding:0px;"src="{{img.data.url}}" alt="" width="100" height="70" />
                                        <a href="{{img.data.url}}" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
                                        <a href="{% url image_editor_main img.id%}" title="Edit Image" class="ui-icon ui-icon-edit">Edit Image</a>
                                        <a href="" title="Delete this image" class="ui-icon ui-icon-trash">Delete image</a>
                                </li>
{% endfor %}
                        </ul>
<form style="margin:0px;padding:0px;" id="delform" name="delform" method="POST" action="">
                        <div id="trash" class="ui-widget-content ui-state-default">
                                <h4 class="ui-widget-header"><span class="ui-icon ui-icon-trash">Trash</span> Trash</h4>
				<div class="ui-widget-content" align=center><a href="#" onClick="document.getElementById('delform').submit();">Empty Trash</a></div>
                        </div>

                </div><!-- End demo -->

</form>
{% else %}
You have no images.
{% endif %}
<hr>
{% if form %}
{% if form.errors %}
{{form.errors}}
{% endif %}
<form enctype="multipart/form-data" method="post" action="{% url image_editor_upload %}">
<dl>
{% for field in form %}
    <dt id="formlabel">{{ field.label }}</dt>
    <dd>{{ field }}</dd>
    {% if field.help_text %}<dd class="help_text">{{ field.help_text }}</dd>{% endif %}
    {% if field.errors %}<dd class="myerrors">{{ field.errors }}</dd>{% endif %}
{% endfor %}
</dl>
<input type="submit" value="Upload"/>
</form>
{% endif %}

{% endblock %}